---
Title: "Part 1: Project Proposal"
Author: "Yolanda Thant, Kosar Hemmati, Shameiza Hussain, Ayushi Verma"
output: 
  pdf_document:
    latex_engine: xelatex
date: "May 15, 2025"
---
```{r setup, include=FALSE}
## Hides both code & output in knitted document 
library(tidyverse)
library(patchwork)
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)  ## Globally suppress all code, messages, & warnings
```

## Introduction

```{r}
## load diamonds dataset
diamonds <- read_csv("./dataset/original_diamonds_dataset.csv")
## list.files("./dataset") 
## getwd()
```

```{r}
## Data Cleaning: Remove predictor variables we don't need: 1st col, cut, depth, y, z
diamonds_cleaned <- diamonds %>% select(-...1, -cut, -depth, -y, -z)
## head(diamonds_cleaned)
write_csv(diamonds_cleaned, "./dataset/diamonds_cleaned.csv")
## summary(diamonds_cleaned)
```

## Data Description
summarize numerically or graphically (in a single figure/table) each predictor in your dataset that
will be used in the preliminary model, and interpret the descrip8ve sta8s8cs in the context of what the predictors
measure and how it relates to the research ques8on

```{r}
## Preliminary (MLR) Model Setup
fit <- lm(price ~ carat + color + clarity + table + x, data=diamonds_cleaned)
## summary(fit)
```

```{r}
## 1(a) Residual vs Fitted | NOTE: Best plot among the 3 to check for these 2 assumptions
## BASE R
## base_r_resid_fitted <- plot(fit, which = 1)  # Residuals vs Fitted

resid_fit <- data.frame(Fitted = fitted(fit), Residuals = resid(fit))
resid_fitted <- ggplot(data=resid_fit, aes(x=Fitted, y=Residuals)) +
  geom_point(alpha=0.4) +  ## Transparency level to help w/ overlapping pts
  geom_smooth(method = "loess", se = FALSE, color = "pink") +
  geom_hline(yintercept = 0, linetype = "dashed", color = "grey") +
  labs(x="Fitted Values", y="Residuals",
       title="Residuals vs Fitted Values")
```

```{r}
price_fitted <- ggplot(data=diamonds_cleaned, aes(x=fitted(fit), y=price)) +
  geom_point(alpha=0.3) +  ## Transparency level to help w/ overlapping pts
  geom_abline(color="red") +
  labs(x="Fitted Values", y="Actual Price",
       title="Price vs Fitted Values")
```

```{r}
## predictors <- c("carat", "color", "clarity", "table", "x")

## price_predictors <- 
##   for (x_i in predictors) {
##   print(
##     ggplot(data=diamonds_cleaned, aes(x=!!sym(x_i), y=price)) +
##       geom_point(alpha=0.2) +
##       geom_smooth(method="lm", color="blue", se = FALSE) +
##       labs(title=paste("Price vs", x_i))
##   )
## }
## !!sym(x_i): Converts str var name into a symbol & unquotes it for aes() to use it directly.

price_carat <- ggplot(data=diamonds_cleaned, aes(x=carat, y=price)) +
  geom_point(alpha=0.2) +
  geom_smooth(method="lm", color="blue", se=FALSE) +
  labs(title="Price vs Carat")

price_color <- ggplot(data=diamonds_cleaned, aes(x=color, y=price)) +
  geom_point(alpha=0.2) +
  geom_smooth(method="lm", color="blue", se=FALSE) +
  labs(title="Price vs Color")

price_clarity <- ggplot(data=diamonds_cleaned, aes(x=clarity, y=price)) +
  geom_point(alpha=0.2) +
  geom_smooth(method="lm", color="blue", se=FALSE) +
  labs(title="Price vs Clarity")

price_table <- ggplot(data=diamonds_cleaned, aes(x=table, y=price)) +
  geom_point(alpha=0.2) +
  geom_smooth(method="lm", color="blue", se=FALSE) +
  labs(title="Price vs Table")

price_x <- ggplot(data=diamonds_cleaned, aes(x=x, y=price)) +
  geom_point(alpha=0.2) +
  geom_smooth(method="lm", color="blue", se=FALSE) +
  labs(title="Price vs x")
```

```{r}
## BASE R
## sresidual_values <- rstandard(fit)
## base_r_sresid_hist <- hist(sresidual_values, xlab="Standardized Residuals", 
                           ## main="Standardized Residuals Histogram")

std_resid <- rstandard(fit)
sresid_hist <- ggplot(data=data.frame(std_resid), aes(x=std_resid)) +
  geom_histogram(bins=30, fill="lightblue", color="black") +
  labs(title="Histogram of Standardized Residuals",
       x="Standardized Residuals", y="Frequency")
```

```{r}
## BASE R
## plot(fit, which=2)

sresid_qq <- ggplot(data=data.frame(std_resid), aes(sample=std_resid)) +
  stat_qq(alpha=0.2) +
  stat_qq_line(color="red", linetype="dashed") +
  labs(title="Normal QQ-Plot of Standardized Residuals")
```

```{r, fig.width=15, fig.height=16}
(resid_fitted | price_fitted | price_carat) / 
  (price_color | price_clarity | price_table) / 
  (price_x | sresid_hist | sresid_qq)
```

## Preliminary Model Results
To investigate how the carat—price relationship varies across different diamond clarity levels after adjusting for color, table size, and x-dimension (length), we fit a Multiple Linear Regression model: 
**price ~ carat + color + clarity + table + x**. 

The residual analysis revealed notable violations of key regression model assumptions: linearity, constant error variance (homoscedasticity), and normality of errors. The **Residuals vs Fitted Values** plot showed a clear, curved LOESS trendline with increasing spread as fitted values increased, suggesting non-linearity and heteroscedasticity. Similarly, the **Price vs Fitted Values** plot showed a generally strong positive relationship, but revealed slight curvature with growing variance at higher price levels, causing concerns about unequal error variance—indicating potential non-linearity and heteroscedasticity. The **Price vs Carat** scatterplot suggested an exponential relationship that a smile linear model fails to capture reasonably. Predictors such as color and clarity showed stratified effects on price, validating them as categorical predictors. However, the **Price vs Table** plot showed a weak and noisy association, with data points highly concentrated in a narrow range, suggesting that the table predictor may not be a strong predictor to predict price. The **Price vs x** plot also showed curvature, suggesting non-linearity.

Furthermore, the **histogram of standardized residuals** sharply peaked around 0 with heavy tails, and the **normal QQ-plot** confirmed it as it showed deviations at both tails, indicating violations of the normality assumption. 

Despite these concerns, the model explains a substantial portion of the variance in price, with an adjusted R^2=0.9174.

The coefficient estimates revealed that **carat** is the strongest numerical predictor: for every additional **carat**, **price** increases by approximately \$10,945.695. Among the categorical predictors, diamonds graded as clarityIF (Internally Flawless) are associated with a \$5,665.892 higher average price than the base-level (I1), holding other variables constant. Lower **color** grades such as J result in significant price reductions, approximately \$2,387.941 less than D. 

Interestingly, numerical predictors **table** and **x** showed negative associations with **price**. Holding other variables constant, a 1-unit increase in the **table** value is associated with an estimated \$32.708 decrease in **price**. This result is counterintuitive, as diamonds with slightly larger **table** sizes are generally more desirable for their ability to reflect light effectively, so increasing their value. Similarly, a 1-unit increase in the x-dimension corresponds to an estimated \$900.27 decrease in **price**, which is also unexpected since longer diamonds are usually more valuable. However, because **x** is strongly correlated with **carat**, this suggests potential multicollinearity—both variables may be capturing similar variance in the data. The large negative coefficient for **x** likely reflects this redundancy. So one might consider centering or removing **x** or replacing it with a composite variable like volume.


These findings suggest that while the model identifies important trends and supports the hypothesis that clarity influences the carat-price relationship, assumption violations and multicollinearity call attention for further model refinement.

## Bibliography
