---
output: 
  pdf_document:
    latex_engine: xelatex
---

```{=latex}
\begin{titlepage}
    \centering
    {\Huge\bfseries STA302 Final Project Part 1: Project Proposal \par}
    {\LARGE What role do a diamond’s characteristics play in predicting its market value? \par}
    \vspace{0.3cm}
    {\large Yolanda Thant, Kosar Hemmati, Shameiza Hussain, Ayushi Verma\par}
    {\large 15 May 2025\par}
\end{titlepage}
```

```{r setup, include=FALSE}
## Hides both code & output in knitted document 
library(tidyverse)  ## For data wrangling & plotting
library(kableExtra)
library(DescTools)
library(patchwork)
library(knitr)
library(skimr)
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)  ## Globally suppress all code, messages, & warnings
```

```{r}
## load diamonds dataset
diamonds <- read_csv("./dataset/original_diamonds_dataset.csv")
## list.files("./dataset") 
## getwd()
```

```{r}
## Data Cleaning: Remove predictor variables we don't need: 1st col, cut, depth, y, z
diamonds_cleaned <- diamonds %>% select(-...1, -cut, -depth, -y, -z)
## head(diamonds_cleaned)
write_csv(diamonds_cleaned, "./dataset/diamonds_cleaned.csv")
## summary(diamonds_cleaned)
```

\section*{Introduction}
When considering a diamond’s value, many consumers rely on a grading system introduced by the Gemological Institute of America (n.d.) called the “4Cs”: carat, cut, clarity, and colour. This system was designed to help consumers of the diamond market understand the value of their purchases based on the values assigned to each of these four traits. While information about factors that influence diamond pricing is publicly available, the numeric impact of each factor is unclear (Lee et al., 2014; Mamonov & Triantoro, 2018). For instance, two diamonds of the same weight can differ vastly in price after accounting for cut, clarity, and colour (Tiffany & Co., n.d.), but the explanation behind this variance has not been rigorously quantified based on our literature research. Thus, our research addresses the question: To what extent do carat, colour, clarity, table size, and length predict the price of a diamond? While previous studies have conducted similar analyses (Mamonov & Triantoro, 2018; Özmen, 2024), our goal is to later refine our model in hopes of explaining more of the observed price variation in our data. Quantifying the effects that different features have on diamond prices can better inform consumers’ judgments on whether they are paying a fair price. 
 
Multiple linear regression (MLR) is a suitable method to answer our question because we are exploring the association between price, a continuous response variable, with several explanatory variables simultaneously. This way, we can infer which diamond factors are the strongest predictors of price. MLR models the (estimated) average of the response versus given values of the predictors, which is relevant to our goal of helping consumers understand where the price of their diamond lies in relation to the estimated average price for their specific diamond profile. The focus of the model will be on interpretability since we are more interested in drawing conclusions about the average effects of our chosen diamond attributes on the price, rather than trying to predict exact prices of all diamonds.

\section*{Exploratory Data Analysis (EDA)}
The selected dataset was retrieved and downloaded from Kaggle (Al Aswad, 2022). There was no explicit research purpose linked to the dataset, and our research question was constructed after a careful review of the variables and corresponding literature surrounding diamond pricing. Further investigation of the dataset revealed that it was originally published in the ggplot2 R package (Wickham et al., n.d.). In particular, the diamond dataset was curated by the contributors of ggplot2, using the Loose Diamond Search Engine (n.d.), which contains historical data on diamond prices and their physical attributes.

\subsection*{Response Variable Summary}
Jewelers justify their valuation of diamonds using physical attributes such as cut, carat, colour, and size. Thus, price is an appropriate response variable as it is dependent on the chosen predictors. Further, price is a continuous numerical value measured in US Dollars, making it suitable for linear regression analysis.

- Large spread, heavy right-skew
- Indicates “rarity” of premium diamonds
```{r}
## Numerical Summary of Response Variable
response_numeric_sum <- data.frame(
  Statistic = c("Minimum", "1st Quartile", "Median", "Mode", "Mean", "Standard Deviation", "3rd Quartile", "Maximum"),
  Value = c(326, 950, 2401, 605, 3933, 3989.338, 5324, 18823)
)
kable(response_numeric_sum, caption="Numerical Summary of Response Variable")

## summary(diamonds_cleaned$price)
## skim(diamonds_cleaned$price)
```

\subsection*{Predictor Variable Summaries}
```{r, fig.width=13, fig.height=9}
## Numerical Summary of Quantitative Predictor Variables
## Table & Transpose
numeric_sum <- diamonds_cleaned %>%
  summarise(
    Min=c(min(carat), min(table), min(x)),
    Q1=c(quantile(carat, 0.25), quantile(table, 0.25), quantile(x, 0.25)),
    Median=c(median(carat), median(table), median(x)),
    Mode=c(Mode(carat), Mode(table), Mode(x)),
    Mean=c(mean(carat), mean(table), mean(x)),
    StandardDeviation=c(sd(carat), sd(table), sd(x)),
    Q3=c(quantile(carat,0.75), quantile(table,0.75), quantile(x,0.75)),
    Max=c(max(carat), max(table), max(x))
  ) %>%
  t() %>%
  as.data.frame()

# Name cols & row labels
colnames(numeric_sum) <- c("Carat", "Table", "x")
numeric_sum$Statistic <- c("Minimum", "1st Quartile", "Median", "Mode", "Mean", "Standard Deviation", "3rd Quartile", "Maximum")

## Reorder cols
numeric_sum <- numeric_sum[, c("Statistic", "Carat", "Table", "x")]

# Round values
numeric_sum <- numeric_sum %>%
  mutate(across(c(Carat, Table, x), ~ round(as.numeric(.), 4)))

kable(numeric_sum, caption = "Numerical Summary of Quantitative Predictor Variables", row.names=FALSE)


carat_hist <- ggplot(diamonds_cleaned, aes(x=carat)) +
  geom_histogram(bins=30, fill="lightblue", color="black") +
  labs(title="Histogram of Carat", x="Carat", y="Frequency")

table_hist <- ggplot(diamonds_cleaned, aes(x=table)) + 
  geom_histogram(bins=30, fill="lightblue", color="black") +
  labs(title="Histogram of Table", x="Table", y="Frequency")

x_hist <- ggplot(diamonds_cleaned, aes(x=x)) + 
  geom_histogram(bins=30, fill="lightblue", color="black") +
  labs(title="Histogram of x (Length)", x="x", y="Frequency")

(carat_hist | table_hist | x_hist)

##-----------------------------------------------------------------------------------------------##

## Frequency & Percentage for each 'color' level
color_freq <- table(diamonds_cleaned$color)
color_prop <- prop.table(color_freq)

## Combine into a data frame
color_catego_df <- data.frame(
  Color=names(color_freq),
  Frequency=as.numeric(color_freq),
  Percentage=round(as.numeric(color_prop)*100, 3)
)
kable(color_catego_df, caption="Numerical Summary of 'Color' Predictor")

## Frequency & Proportion for each 'clarity' level
clarity_freq <- table(diamonds_cleaned$clarity)
clarity_prop <- prop.table(clarity_freq)

## Combine into a data frame
clarity_catego_df <- data.frame(
  Clarity=names(clarity_freq),
  Frequency=as.numeric(clarity_freq),
  Percentage=round(as.numeric(clarity_prop)*100, 3)
)
kable(clarity_catego_df, caption="Numerical Summary of 'Clarity' Predictor")

## Graphical Summary of Predictor Variables

## Boxplot confirms that color is not constant & shows some variation in price.
## Can use as predictor in modeling price.
price_color_box <- ggplot(data=diamonds_cleaned, aes(x=color, y=price)) +
  geom_boxplot(fill="lightblue", color="black") +
  labs(title="Boxplot of Price by Color",
       x="Color", y="Price")

## Boxplot confirms that clarity does is not constant & shows meaningful variation in price.
## Can use as predictor in modeling price.
price_clarity_box <- ggplot(data=diamonds_cleaned, aes(x=clarity, y=price)) +
  geom_boxplot(fill="lightblue", color="black") +
  labs(title="Boxplot of Price by Clarity",
       x="Clarity", y="Price")

(price_color_box | price_clarity_box)
```

**Carat – diamond weight (1 carat = 0.2 grams)** 

- Large spread, heavy right-skew mirroring price histogram
- Rarity of high carat and histogram similarity suggest carat to be the strongest predictor of price

**Table - width of diamond’s top surface as % of total width**  

- Large spread due to heavy right tail, mild right-skew
- Rarity of high table % suggest relationship with price

**x - length (in mm) of diamond**

- Large spread, slight right-skew
- Overestimated spread due to nonsensical zero entries (requires data cleaning)
- Rarity of longer diamonds suggest relationship with price

**Color - grading from best (D) to worst (J) (Diamond Color Scale, n.d.)** 

- Frequency peak around medium grade (G)
- Each grading has heavy right-skew
- Changes in median price and number of outliers among color grades suggests relationship with price

**Clarity - grading from best (IF) to worst (I1) (Diamond Clarity Guide, n.d.)** 

- Frequency peak around medium grades (VS2 & SI1)
- Each grading has heavy right-skew
- Clarity decline corresponds to lower medians suggesting relationship with price

```{r include-images, fig.align='center', out.width='37%', fig.cap='\\small Colour (Diamond Color Scale, n.d.) and Clarity (Diamond Clarity Guide, n.d.) Gradings for Diamonds'}
## Pictures for color & clarity gradings
knitr::include_graphics("./color_grading.png")
knitr::include_graphics("./clarity_grading.png")
```

```{r}
## Preliminary (MLR) Model Setup
fit <- lm(price ~ carat + color + clarity + table + x, data=diamonds_cleaned)
## summary(fit)
```

```{r}
## 1(a) Residual vs Fitted Values Plot | NOTE: Best plot among the 3 1(a)(b)(c) to check for 1st 2 assumptions
resid_fit <- data.frame(Fitted = fitted(fit), Residuals = resid(fit))
resid_fitted <- ggplot(data=resid_fit, aes(x=Fitted, y=Residuals)) +
  geom_point(alpha=0.4) +  ## Transparency level to help w/ overlapping pts
  geom_smooth(method = "loess", se = FALSE, color = "blue") +
  geom_hline(yintercept = 0, linetype = "dashed", color = "grey") +
  labs(x="Fitted Values", y="Residuals",
       title="Residuals vs Fitted Values")
```

```{r}
## 1(b) Response vs Fitted Values Plot
price_fitted <- ggplot(data=diamonds_cleaned, aes(x=fitted(fit), y=price)) +
  geom_point(alpha=0.3) +  ## Transparency level to help w/ overlapping pts
  geom_abline(color="blue") +
  labs(x="Fitted Values", y="Actual Price",
       title="Price vs Fitted Values")
```

```{r}
## 1(b) Response vs Predictor Values Plot

## predictors <- c("carat", "color", "clarity", "table", "x")

## price_predictors <- 
##   for (x_i in predictors) {
##   print(
##     ggplot(data=diamonds_cleaned, aes(x=!!sym(x_i), y=price)) +
##       geom_point(alpha=0.2) +
##       geom_smooth(method="lm", color="blue", se = FALSE) +
##       labs(title=paste("Price vs", x_i))
##   )
## }
## !!sym(x_i): Converts str var name into a symbol & unquotes it for aes() to use it directly.

price_carat <- ggplot(data=diamonds_cleaned, aes(x=carat, y=price)) +
  geom_point(alpha=0.2) +
  geom_smooth(method="lm", color="blue", se=FALSE) +
  labs(title="Price vs Carat")

price_color <- ggplot(data=diamonds_cleaned, aes(x=color, y=price)) +
  geom_point(alpha=0.2) +
  geom_smooth(method="lm", color="blue", se=FALSE) +
  labs(title="Price vs Color")

price_clarity <- ggplot(data=diamonds_cleaned, aes(x=clarity, y=price)) +
  geom_point(alpha=0.2) +
  geom_smooth(method="lm", color="blue", se=FALSE) +
  labs(title="Price vs Clarity")

price_table <- ggplot(data=diamonds_cleaned, aes(x=table, y=price)) +
  geom_point(alpha=0.2) +
  geom_smooth(method="lm", color="blue", se=FALSE) +
  labs(title="Price vs Table")

price_x <- ggplot(data=diamonds_cleaned, aes(x=x, y=price)) +
  geom_point(alpha=0.2) +
  geom_smooth(method="lm", color="blue", se=FALSE) +
  labs(title="Price vs x")
```

```{r}
## 2(a) Histogram of Standardized Residuals
std_resid <- rstandard(fit)
sresid_hist <- ggplot(data=data.frame(std_resid), aes(x=std_resid)) +
  geom_histogram(bins=30, fill="lightblue", color="black") +
  labs(title="Histogram of Standardized Residuals",
       x="Standardized Residuals", y="Frequency")
```

```{r}
## Normal QQ-Plot of Standardized Residuals
sresid_qq <- ggplot(data=data.frame(std_resid), aes(sample=std_resid)) +
  stat_qq(alpha=0.2) +
  stat_qq_line(color="red", linetype="dashed") +
  labs(title="Normal QQ-Plot of Standardized Residuals", 
       x="Theoretical Quantiles", y="Standardized Residuals")
```

\section*{Preliminary Model Results}
```{r, fig.width=15, fig.height=17}
(resid_fitted | price_fitted | price_carat) / 
  (price_color | price_clarity | price_table) / 
  (price_x | sresid_hist | sresid_qq)
```

\begin{align*}
y =\ & \beta_0 + \beta_1 \cdot \text{carat} + \beta_2 \cdot I(\text{color} = E) + \beta_3 \cdot I(\text{color} = F) + \beta_4 \cdot I(\text{color} = G) + \beta_5 \cdot I(\text{color} = H) \\
& + \beta_6 \cdot I(\text{color} = I) + \beta_7 \cdot I(\text{color} = J) + \beta_8 \cdot I(\text{clarity} = \text{IF}) + \beta_9 \cdot I(\text{clarity} = \text{SI1}) \\
& + \beta_{10} \cdot I(\text{clarity} = \text{SI2}) + \beta_{11} \cdot I(\text{clarity} = \text{VS1}) + \beta_{12} \cdot I(\text{clarity} = \text{VS2}) \\
& + \beta_{13} \cdot I(\text{clarity} = \text{VVS1}) + \beta_{14} \cdot I(\text{clarity} = \text{VVS2}) + \beta_{15} \cdot \text{table} + \beta_{16} \cdot x + \epsilon \\[0.5em]
\text{} & \text{Assume } \mathbb{E}[\epsilon] = 0, \mathbb{V}[\epsilon] = \sigma^2, \text{and } \epsilon \overset{\text{i.i.d.}}{\sim} N(0, \sigma^2) \\[0.5em]
\hat{E}[y] =\ & \hat{y} =\ \hat{\beta}_0 + \hat{\beta}_1 \cdot \text{carat} + \hat{\beta}_2 \cdot I(\text{color} = E) + \hat{\beta}_3 \cdot I(\text{color} = F) + \hat{\beta}_4 \cdot I(\text{color} = G) + \hat{\beta}_5 \cdot I(\text{color} = H) \\
& + \hat{\beta}_6 \cdot I(\text{color} = I) + \hat{\beta}_7 \cdot I(\text{color} = J) + \hat{\beta}_8 \cdot I(\text{clarity} = \text{IF}) + \hat{\beta}_9 \cdot I(\text{clarity} = \text{SI1}) \\
& + \hat{\beta}_{10} \cdot I(\text{clarity} = \text{SI2}) + \hat{\beta}_{11} \cdot I(\text{clarity} = \text{VS1}) + \hat{\beta}_{12} \cdot I(\text{clarity} = \text{VS2}) \\
& + \hat{\beta}_{13} \cdot I(\text{clarity} = \text{VVS1}) + \hat{\beta}_{14} \cdot I(\text{clarity} = \text{VVS2}) + \hat{\beta}_{15} \cdot \text{table} + \hat{\beta}_{16} \cdot x
\end{align*}

```{r}
## Numerical Summary of Coefficient Estimates
coef_esti_numeric_sum <- data.frame(
  Term = c("(Intercept)", "carat", "colorE", "colorF", "colorG", "colorH", "colorI", "colorJ",
           "clarityIF", "claritySI1", "claritySI2", "clarityVS1", "clarityVS2", "clarityVVS1", "clarityVVS2",
           "table", "x"),
  Estimate = c(-1388.839, 10945.695, -210.489, -286.752, -493.858, -993.809, -1474.570, -2387.941,
               5665.892, 3894.266, 2926.092, 4845.059, 4528.148, 5309.983, 5234.228, -32.708, -900.270)
)
kable(coef_esti_numeric_sum, digits=3, caption="Numerical Summary of Coefficient Estimates")

## summary(fit)
```

\section*{Residual Analysis}
Curvature in the **Residuals vs. Fitted Values** and **Price vs. Fitted Values** plots, and exponential trend in the **Price vs Carat** plot suggests non-linearity. Spread increasing with fitted values indicates heteroscedasticity.   

**color** and **clarity** don’t appear as strong predictors of **price** due to visible constant spread of points across levels. However, boxplots—shown in **EDA**—reveal stratified effects on price—confirming their contribution to **price** variation.  
  
Although maximum prices are similar across levels of **color**, median prices differ. **color** J shows higher medians while D shows higher outliers.  

Diamonds with **clarity** I1 show outliers and higher median prices, whereas **clarity** IF shows more outliers and lower medians. This stratification supports both being valid diamond price predictors.  
 
The **Price vs Table** plot showed a weak, noisy association with data points concentrated in a narrow range, suggesting **table** size may not strongly predict price. The **Price vs x** plot also curves, suggesting non-linearity.  
 
The **histogram of standardized residuals** sharply peaked around 0 with heavy tails, and **normal QQ-plot** showed deviations at both tails—violating normality of errors.   
 
From the model estimates, a diamond with **color** D, **clarity** I1, and 0 for **table**, **x**, and **carat**, predicted an average **price** of -\$1,388.389. Though not practically meaningful, it serves as model’s baseline.  
Keeping the same values for continuous predictors with **color** E and **clarity** IF, the estimated average **price** increases to \$4,066.564, reflecting strong contribution of high **clarity**.  
 
With same values, a 1-gram increase in **carat** raises predicted average price by \$10,945.695/**carat**, confirming **carat** as the strongest predictor.  
 
Interestingly, **table** and **x** are negatively associated with **price**: coefficients −\$32.71 and −\$900.27, respectively. This is counterintuitive as larger dimensions are generally desirable. **x** likely reflects multicollinearity with **carat**; both capture size-related information, suggesting we can remove/replace **x**. 

```{=latex}
\section*{Bibliography}
\begingroup
\setlength{\parindent}{0pt}
\setlength{\parskip}{8pt}

\hangindent=0.5in Al Aswad, Ms. N. (2022, July 9). \textit{Diamonds Prices}. Kaggle. \url{https://www.kaggle.com/datasets/nancyalaswad90/diamonds-prices}  

\hangindent=0.5in \textit{Diamond Color Scale | Color Chart, Scale, \& Grading Guide}. Brilliant Earth. (n.d.). \url{https://www.brilliantearth.com/en-ca/diamond/buying-guide/color/?utm_source=google\&utm_medium=cpc\&utm_campaign=SEM_Search_CA001_Bridal_Conversion\&gad_campaignid=14386530662} 

\hangindent=0.5in \textit{Diamond Clarity Guide | Clarity Chart, scale, \& best grades}. Brilliant Earth. (n.d.). \url{https://www.brilliantearth.com/en-ca/diamond/buying-guide/clarity/} 

\hangindent=0.5in Diamond Prices Comparison. Loose Diamonds Search Engine. (n.d.). \url{https://www.diamondse.info/diamond-prices.asp}

\hangindent=0.5in Gemological Institute of America. (n.d.). \textit{4Cs of diamond quality}. Retrieved May 20, 2025, from \url{https://4cs.gia.edu/en-us/4cs-of-diamond-quality/}

\hangindent=0.5in Lee, J. A., Caudill, S. B., \& Mixon, F. G. (2014). Shine bright like a diamond: A hedonic model of grading and pricing an experience good. \textit{Applied Economics, 46}(16), 1829--1838. \url{https://doi.org/10.1080/00036846.2014.884707}

\hangindent=0.5in Mamonov, S., \& Triantoro, T. (2018). Subjectivity of diamond prices in online retail: Insights from a data mining study. \textit{Journal of Theoretical and Applied Electronic Commerce Research, 13}(2), 15--28. \url{https://doi.org/10.4067/s0718-18762018000200103}

\hangindent=0.5in \"Ozmen, G. (2024, August 12). \textit{More than carat: A comprehensive regression analysis for diamond price prediction}. Medium. \url{https://medium.com/@gizemzmen/more-than-carat-a-comprehensive-regression-analysis-for-diamond-price-prediction-b9222f337154}

\hangindent=0.5in Tiffany \& Co. (n.d.). \textit{What Is A Diamond Carat?} Retrieved May 20, 2025, from \url{https://www.tiffany.ca/engagement/the-tiffany-guide-to-diamonds/carat/}

\hangindent=0.5in Wickham, H., van den Brand, T., Dunnington, D., Yutani, H., Woo, K., Wilke, C., Takahashi, K., Pedersen, T. L., Henry, L., \& Chang, W. (n.d.). \textit{Prices of Over 50,000 Round Cut Diamonds}. ggplot2. \url{https://ggplot2.tidyverse.org/reference/diamonds.html\#ref-usage}

\endgroup
```
